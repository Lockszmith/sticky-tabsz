#!/usr/bin/env bash
# Commit-msg hook - validates commit message follows conventional format
# Install with: git config core.hooksPath .githooks

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

# Skip merge commits
if [[ "$commit_msg" =~ ^Merge ]]; then
    exit 0
fi

# Conventional commit pattern
pattern='^(feat|fix|docs|chore|refactor|test|style|perf|ci|build|revert)(\(.+\))?: .+'

if ! [[ "$commit_msg" =~ $pattern ]]; then
    echo ""
    echo "ERROR: Commit message doesn't follow conventional format!"
    echo ""
    echo "Expected: <type>(<scope>): <description>"
    echo "Types: feat, fix, docs, chore, refactor, test, style, perf, ci, build, revert"
    echo ""
    echo "Examples:"
    echo "  feat: add new feature"
    echo "  fix(build): resolve packaging issue"
    echo "  docs: update README"
    echo ""
    echo "Your message: $commit_msg"
    echo ""
    exit 1
fi

exit 0

