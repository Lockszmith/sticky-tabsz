<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sticky TabSZ - Settings</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <div>
          <h1>Sticky TabSZ</h1>
          <p class="subtitle">Configure your sticky tab rules</p>
        </div>
        <button type="button" id="pop-out-btn" class="btn-icon-only" title="Open in new tab">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" opacity="0.5"/>
            <path d="M9 3h12v12"/>
            <line x1="21" y1="3" x2="12" y2="12"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="tabs">
      <button class="tab-btn active" data-tab="rules">Rules</button>
      <button class="tab-btn" data-tab="settings">Settings</button>
      <button class="tab-btn" data-tab="release-notes">Release Notes</button>
    </nav>

    <main>
      <!-- Rules Tab -->
      <section id="tab-rules" class="tab-content active">
        <div class="section-header">
          <h2>Rules</h2>
          <button type="button" id="add-rule" class="btn btn-primary">+ Add Rule</button>
        </div>
        
        <div id="rules-container">
          <!-- Rules will be dynamically inserted here -->
        </div>
        
        <div id="no-rules" class="empty-state">
          <p>No rules configured yet.</p>
          <p>Click "Add Rule" to create your first sticky tab rule.</p>
        </div>

        <div class="tab-actions">
          <button type="button" id="save-btn" class="btn btn-success">Save Rules</button>
          <span id="save-status" class="save-status"></span>
        </div>
      </section>

      <!-- Settings Tab -->
      <section id="tab-settings" class="tab-content">
        <h2>Settings</h2>
        
        <div class="settings-group">
          <h3>Logging</h3>
          <label class="checkbox-label">
            <input type="checkbox" id="setting-debug-logging">
            <span>Enable debug logging</span>
          </label>
          <small>Log detailed information to the browser console for troubleshooting</small>
        </div>

        <div class="settings-group">
          <h3>Behavior</h3>
          <label class="checkbox-label">
            <input type="checkbox" id="setting-focus-sticky" checked>
            <span>Focus sticky tab after redirect</span>
          </label>
          <small>Automatically switch to the sticky tab when a URL is redirected to it</small>
        </div>

        <div class="settings-group">
          <h3>Sync</h3>
          <label class="checkbox-label">
            <input type="checkbox" id="setting-use-sync">
            <span>Sync rules via Firefox Sync</span>
          </label>
          <small>Sync your rules across devices using your Firefox Account. Requires Firefox Sync to be enabled.</small>
          <div id="sync-status" class="sync-status"></div>
        </div>

        <div class="settings-group">
          <h3>Data</h3>
          <div class="btn-group">
            <button type="button" id="export-rules" class="btn btn-secondary">Export Rules</button>
            <button type="button" id="import-rules" class="btn btn-secondary">Import Rules</button>
          </div>
          <small>Backup or restore your rules configuration</small>
          <input type="file" id="import-file" accept=".json" style="display: none;">
        </div>

      </section>

      <!-- Release Notes Tab -->
      <section id="tab-release-notes" class="tab-content">
        <h2>Release Notes</h2>
        
        <div class="release-notes">
          <article class="release">
            <h3>v0.1.7 <span class="release-date">December 2025</span></h3>
            <ul>
              <li><strong>Firefox Sync support</strong> - optionally sync rules across devices via Firefox Account</li>
              <li>Unsaved changes indicator with visual warning on Save button</li>
              <li>Confirmation prompt when leaving page with unsaved changes</li>
              <li>Tab state persists in URL (use <code>#rules</code>, <code>#settings</code>, <code>#release-notes</code>)</li>
              <li>Debug logging now off by default</li>
            </ul>
          </article>

          <article class="release">
            <h3>v0.1.6 <span class="release-date">December 2025</span></h3>
            <ul>
              <li>First release to <a href="https://addons.mozilla.org/en-US/firefox/addon/sticky-tabsz/" target="_blank">Mozilla Add-ons</a></li>
              <li>Toolbar popup shows active rule or "Create Rule..." for current tab</li>
              <li>Click "Create Rule..." to auto-generate rule from current page</li>
              <li>Auto-fills rule name (hostname), description (page title), and sticky pattern (URL regex)</li>
              <li>Fix toggle switch styling</li>
              <li>Focus on pattern field when creating/editing rules</li>
            </ul>
          </article>

          <article class="release">
            <h3>v0.1.5 <span class="release-date">December 2025</span></h3>
            <ul>
              <li>Added pop-out button to open preferences in a new tab</li>
              <li>Removed popup workaround, using standard Firefox preferences</li>
              <li>Pop-out icon inspired by <a href="https://thenounproject.com/browse/icons/term/pop-out/" target="_blank">The Noun Project</a></li>
            </ul>
          </article>

          <article class="release">
            <h3>v0.1.4 <span class="release-date">December 2025</span></h3>
            <ul>
              <li>Added extension icon (blue tack on tab)</li>
              <li>Added tabbed settings interface</li>
              <li>Added Settings tab with global options</li>
              <li>Added Import/Export functionality</li>
              <li>Added Release Notes tab</li>
            </ul>
          </article>

          <article class="release">
            <h3>v0.1.0 <span class="release-date">December 2025</span></h3>
            <ul>
              <li>Initial release with configurable rules</li>
              <li>Multi-Account Container support</li>
              <li>SPA navigation detection (history state updates)</li>
              <li>Sticky patterns and match patterns</li>
              <li>Per-container or global sticky tab tracking</li>
            </ul>
          </article>

          <article class="release">
            <h3>v0.0.1 <span class="release-date">December 2025</span></h3>
            <ul>
              <li>Proof of concept</li>
              <li>Hardcoded Salesforce Case pattern</li>
              <li>Basic sticky tab functionality</li>
            </ul>
          </article>
        </div>
      </section>
    </main>

    <footer>
      <p class="footer-info">
        <a href="https://code.lksz.me/lksz/sticky-tabsz" target="_blank">Homepage</a>
        <span class="separator">•</span>
        <a href="https://github.com/Lockszmith-GH/sticky-tabsz/discussions" target="_blank">Community</a>
        <span class="separator">•</span>
        <a href="https://code.lksz.me/lksz/sticky-tabsz/issues" target="_blank">Report Issue</a>
        <br/>Sticky TabSZ v<span id="version">0.1.7</span> by Lockszmith
      </p>
    </footer>
  </div>

  <!-- Rule Template -->
  <template id="rule-template">
    <div class="rule-card" data-rule-id="">
      <div class="rule-header">
        <div class="rule-header-left">
          <label class="toggle">
            <input type="checkbox" class="rule-enabled" checked>
            <span class="toggle-slider"></span>
          </label>
          <input type="text" class="rule-name" placeholder="rule-name" pattern="[a-zA-Z0-9_-]+" required>
        </div>
        <button type="button" class="btn btn-danger btn-small delete-rule">Delete</button>
      </div>

      <div class="rule-body">
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" class="container-separation" checked>
            <span>Container Separation</span>
          </label>
          <small>When enabled, each Multi-Account Container gets its own sticky tab</small>
        </div>

        <div class="form-group">
          <label>Sticky Patterns <span class="required">*</span></label>
          <small>URLs matching these patterns can become sticky tabs (at least one required)</small>
          <div class="pattern-list sticky-patterns">
            <!-- Patterns added dynamically -->
          </div>
          <button type="button" class="btn btn-secondary btn-small add-sticky-pattern">+ Add Pattern</button>
        </div>

        <div class="form-group">
          <label>Match Patterns</label>
          <small>URLs matching these patterns will redirect to the sticky tab (optional, checked first)</small>
          <div class="pattern-list match-patterns">
            <!-- Patterns added dynamically -->
          </div>
          <button type="button" class="btn btn-secondary btn-small add-match-pattern">+ Add Pattern</button>
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea class="rule-description" placeholder="Optional description for this rule..."></textarea>
        </div>
      </div>
    </div>
  </template>

  <!-- Pattern Input Template -->
  <template id="pattern-template">
    <div class="pattern-input">
      <input type="text" class="pattern-value" placeholder="e.g., ^https://example\\.com/path/.*">
      <button type="button" class="btn btn-danger btn-icon remove-pattern">×</button>
    </div>
  </template>

  <script src="options.js"></script>
</body>
</html>
